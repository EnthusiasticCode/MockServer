{
    "sets":
    {
        "default": {
            "responses": ["find", "put", "delete", "mkcol", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "All commands succeed"
        },

        "make fails": {
            "responses": ["find", "put", "delete", "mkcol-fail", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "Making directory fails as if it already exists"
        },

        "make hangs": {
            "responses": ["find", "put", "delete", "mkcol-hang", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "Making directory hangs - client should time out eventually."
        },

        "make disconnects": {
            "responses": ["find", "put", "delete", "mkcol-disconnect", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "Making directory hangs - client should time out eventually."
        },

        "put fails": {
            "responses": ["find", "put-fail", "delete", "mkcol", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "Put command fails."
        },

        "put hangs": {
            "responses": ["find", "put-hang", "delete", "mkcol", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "Put command hangs - client should time out eventually."
        },

        "put disconnects": {
            "responses": ["find", "put-disconnect", "delete", "mkcol", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "Put command disconnects the connection abruptly."
        },

        "delete fails": {
            "responses": ["find", "put", "delete-fail", "mkcol", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "Delete command fails."
        },

        "delete hangs": {
            "responses": ["find", "put", "delete-hang", "mkcol", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "Delete command hangs - client should time out eventually."
        },

        "delete disconnects": {
            "responses": ["find", "put", "delete-disconnect", "mkcol", "command-unauthorized", "unknown", "unauthorized" ],
            "comment" : "Delete command disconnects the connection abruptly."
        },

    },

    "responses":
    {
        "find":   {
            "pattern" : "PROPFIND ([a-zA-Z0-9\/]+) HTTP\/1.1.*Authorization: Basic dXNlcjpkZW1v.*",
            "commands" : [
                          "HTTP/1.1 207 Multi-Status\r\nDate: $date\r\nServer: Apache/2.2.14 (Unix) DAV/2 mod_ssl/2.2.14 OpenSSL/0.9.8l PHP/5.3.1 mod_perl/2.0.4 Perl/v5.10.1\r\nContent-Type: text/xml; charset=\"utf-8\"\r\n\r\n",

                          "<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n",
                          "<D:multistatus xmlns:D=\"DAV:\" xmlns:ns0=\"DAV:\">",

                          "<D:response xmlns:lp1=\"DAV:\">",
                          "<D:href>$1directory</D:href>",
                          "<D:propstat>",
                          "<D:prop>",
                          "<lp1:resourcetype><D:collection/></lp1:resourcetype>",
                          "</D:prop>",
                          "<D:status>HTTP/1.1 200 OK</D:status>",
                          "</D:propstat>",
                          "</D:response>",

                          "<D:response xmlns:lp1=\"DAV:\">",
                          "<D:href>$1file.txt</D:href>",
                          "<D:propstat>",
                          "<D:prop>",
                          "<lp1:resourcetype/>",
                          "</D:prop>",
                          "<D:status>HTTP/1.1 200 OK</D:status>",
                          "</D:propstat>",
                          "</D:response>",

                          "</D:multistatus>\r\n",
                          "«close»"
                          ]
        },

        "put": {
            "pattern": "PUT.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 204 No Content\r\n\r\n",
                          "«close»"
                          ]
        },

        "put-hang": {
            "pattern": "PUT.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 204 No Content",
                          ],

            "comment" : "Put appears to work, but doesn't quite finish sending the response. The client should hang (until it times out)"
        },
        
        "put-fail": {
            "pattern": "PUT.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 405 Method Not Allowed\r\n\r\n",
                          "«close»"
                          ]
        },

        "put-disconnect": {
            "pattern": "PUT.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1",
                          "«close»"
                          ],

            "comment" : "Put appears to work, but doesn't quite finish sending the response. The client should hang (until it times out)"
        },

        "delete": {
            "pattern": "DELETE.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 204 No Content\r\n\r\n",
                          "«close»"
                          ]
        },

        "delete-hang": {
            "pattern": "DELETE.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 204 No Content",
                          ]
        },

        "delete-disconnect": {
            "pattern": "DELETE.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1",
                          "«close»"
                          ]
        },

        "delete-file-missing": {
            "pattern": "DELETE.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 404 Not Found\r\n\r\n",
                          "«close»"
                          ]
        },

        "delete-fail": {
            "pattern": "DELETE.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 405 Method Not Allowed\r\n\r\n",
                          "«close»"
                          ]
        },

        "mkcol": {
            "pattern": "MKCOL.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 204 No Content\r\n\r\n",
                          "«close»"
                          ]
        },

        "mkcol-fail": {
            "pattern": "MKCOL.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 405 Method Not Allowed\r\n\r\n",
                          "«close»"
                          ]
        },

        "mkcol-hang": {
            "pattern": "MKCOL.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1 204 No Content",
                          ]
        },

        "mkcol-disconnect": {
            "pattern": "MKCOL.*Authorization: Basic dXNlcjpwYXNz.*",

            "commands" : [
                          "HTTP/1.1",
                          "«close»"
                          ]
        },

        "command-unauthorized": {
            "pattern": "(PROPFIND|GET|PUT|DELETE|MKCOL).*Authorization: Basic .*",

            "commands" : [
                          "HTTP/1.0 401 Unauthorized\r\n",
                          "WWW-Authenticate: Basic realm=\"test\"\r\n\r\n",
                          "«close»"
                          ]
        },

        "unknown":
        {
            "pattern": ".*Authorization: Basic .*",
            "commands": [

                         "HTTP/1.0 501 Not Implemented\r\n\r\b",
                         "«close»"
                         ]
        },


        "unauthorized":
        {
            "pattern" : ".*\r\n\r\n.*",
            "commands" : [
                          "HTTP/1.0 401 Unauthorized\r\n",
                          "WWW-Authenticate: Basic realm=\"test\"\r\n\r\n",
                          "«close»"
                          ]
        },
        
    }
}